<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Draw Your Text</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
  <style>
    body {
      background-color: #666;
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      display: flex;
      gap: 40px;
    }

    .input-board {
      background: white;
      padding: 20px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      width: 500px;
    }

    .input-board h3 {
      margin: 0 0 10px;
      font-size: 16px;
    }

    canvas {
      background: #eee;
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: crosshair;
      width: 100%;
      height: 300px;
    }

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .controls button {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      background: #ddd;
      cursor: pointer;
    }

    .output {
      background: white;
      padding: 15px;
      border-radius: 10px;
      min-width: 300px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-family: "Segoe UI", sans-serif;
    }

    .output-title {
      font-size: 14px;
    }

    .output-box {
      background: #eee;
      padding: 10px;
      border-radius: 5px;
      min-height: 30px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .cursor-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    #copyBtn, #backspaceBtn, #leftArrowBtn, #rightArrowBtn {
      padding: 8px 12px;
      font-size: 14px;
      background-color: #ddd;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-family: "Segoe UI", sans-serif;
    }

    #copyBtn {
      width: fit-content;
      align-self: center;
    }

    .cursor-controls .nav-controls {
      display: flex;
      gap: 10px;
    }

    .blinking-cursor {
      animation: blink 1s step-start 0s infinite;
    }

    @keyframes blink {
      50% {
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-board">
      <h3>Draw your words here in the input board:</h3>
      <canvas id="drawCanvas"></canvas>
      <div class="controls">
        <button id="clearBtn">Clear Board ✌</button>
        <button id="undoStrokeBtn">↶</button>
        <button id="redoStrokeBtn">↷</button>
        <button id="recognizeBtn">Recognize</button>
      </div>
    </div>
    <div class="output">
      <div class="output-title">Example output...</div>
      <div class="output-box" id="outputBox">_</div>
      <div class="cursor-controls">
        <div class="nav-controls">
          <button id="leftArrowBtn">←</button>
          <button id="rightArrowBtn">→</button>
        </div>
        <button id="backspaceBtn">⌫</button>
      </div>
      <button id="copyBtn">Copy Text</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');

    const outputBox = document.getElementById('outputBox');
    const clearBtn = document.getElementById('clearBtn');
    const undoBtn = document.getElementById('undoStrokeBtn');
    const redoBtn = document.getElementById('redoStrokeBtn');
    const recognizeBtn = document.getElementById('recognizeBtn');
    const copyBtn = document.getElementById('copyBtn');
    const backspaceBtn = document.getElementById('backspaceBtn');
    const leftArrowBtn = document.getElementById('leftArrowBtn');
    const rightArrowBtn = document.getElementById('rightArrowBtn');

    let isDrawing = false;
    let strokes = [];
    let undoneStrokes = [];
    let cursorIndex = 0;
    let textContent = "";
    let currentStroke = [];

    function scaleCanvas() {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.scale(dpr, dpr);

      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
    }
    scaleCanvas();

    function redrawCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      for (const stroke of strokes) {
        if (stroke.length > 0) {
          ctx.moveTo(stroke[0].x, stroke[0].y);
          for (let i = 1; i < stroke.length; i++) {
            ctx.lineTo(stroke[i].x, stroke[i].y);
          }
        }
      }
      ctx.stroke();
    }

    function startDraw(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX - rect.left);
      const y = (e.clientY - rect.top);
      currentStroke = [{ x, y }];
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    function draw(e) {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX - rect.left);
      const y = (e.clientY - rect.top);
      ctx.lineTo(x, y);
      ctx.stroke();
      currentStroke.push({ x, y });
    }

    function endDraw() {
      if (!isDrawing) return;
      isDrawing = false;
      ctx.closePath();
      if (currentStroke.length > 0) {
        strokes.push(currentStroke);
        undoneStrokes = [];
      }
    }

    function recognizeText() {
      const imageDataURL = canvas.toDataURL('image/png');
      Tesseract.recognize(
        imageDataURL,
        'eng',
        { logger: m => console.log(m) }
      ).then(({ data: { text } }) => {
        const cleanText = text.replace(/\n/g, ' ').trim();
        if (cleanText) {
          textContent =
            textContent.slice(0, cursorIndex) + cleanText + ' ' + textContent.slice(cursorIndex);
          cursorIndex += cleanText.length + 1;
          renderOutput();
        }
      });
    }

    function renderOutput() {
      if (!textContent) {
        outputBox.textContent = '_';
        return;
      }
      const before = textContent.slice(0, cursorIndex);
      const after = textContent.slice(cursorIndex);
      outputBox.innerHTML = before + '<span class="blinking-cursor">|</span>' + after;
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(textContent).then(() => {
        copyBtn.textContent = 'Copied!';
        setTimeout(() => (copyBtn.textContent = 'Copy Text'), 1500);
      });
    }

    function backspaceOutput() {
      if (cursorIndex > 0) {
        textContent = textContent.slice(0, cursorIndex - 1) + textContent.slice(cursorIndex);
        cursorIndex--;
        renderOutput();
      }
    }

    clearBtn.addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      strokes = [];
      undoneStrokes = [];
    });

    undoBtn.addEventListener('click', () => {
      if (strokes.length > 0) {
        const last = strokes.pop();
        undoneStrokes.push(last);
        redrawCanvas();
      }
    });

    redoBtn.addEventListener('click', () => {
      if (undoneStrokes.length > 0) {
        const recovered = undoneStrokes.pop();
        strokes.push(recovered);
        redrawCanvas();
      }
    });

    leftArrowBtn.addEventListener('click', () => {
      if (cursorIndex > 0) {
        cursorIndex--;
        renderOutput();
      }
    });

    rightArrowBtn.addEventListener('click', () => {
      if (cursorIndex < textContent.length) {
        cursorIndex++;
        renderOutput();
      }
    });

    recognizeBtn.addEventListener('click', recognizeText);
    copyBtn.addEventListener('click', copyToClipboard);
    backspaceBtn.addEventListener('click', backspaceOutput);

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mouseleave', endDraw);

    renderOutput();
  </script>
</body>
</html>